<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html lang="en-US">
<head>
<meta http-equiv="Content-type" content="text/html; charset=iso-8859-1">
<title>Adding New Object Mappings (NIS+ to LDAP) - System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</title>
<meta name="robots" content="index,follow">
<meta name="robots" content="index,follow">
<meta name="date" content="2009-01-01">
<meta name="collection" content="reference">
<link rel="stylesheet" type="text/css" href="css/elements.css">
<link rel="stylesheet" type="text/css" href="css/indiana.css">
</head>

<body>


<div class="Masthead">
   <div class="MastheadLogo">
      <a href="http://www.opensolaris.org"><img border="0" src="graphics/header.png"></img></a>
   </div>
   <div class="Title">System Administration Guide: Naming and Directory Services (DNS, NIS, and LDAP)</div>
</div>

<table class="Layout" border="0" cellspacing="0" width="100%">
<tbody>

   <tr valign="top" class="PageControls">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nisplus2ldap-57.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nisplus2ldap-70.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
   
   <tr valign="top">
      <td class="Navigation" width="200px"><p class="toc level1"><a href="docinfo.html">Document Information</a></p>
<p class="toc level1 tocsp"><a href="preface-1.html">Preface</a></p>
<p class="toc level1 tocsp"><a href="intro-1.html">Part&nbsp;I&nbsp;About Naming and Directory Services</a></p>
<p class="toc level2"><a href="intro2ns-2.html">1.&nbsp;&nbsp;Naming and Directory Services (Overview)</a></p>
<p class="toc level2"><a href="a12swit-86415.html">2.&nbsp;&nbsp;The Name Service Switch (Overview)</a></p>
<p class="toc level1 tocsp"><a href="dnsadmin-1.html">Part&nbsp;II&nbsp;DNS Setup and Administration</a></p>
<p class="toc level2"><a href="dnsref-1.html">3.&nbsp;&nbsp;DNS Setup and Administration (Reference)</a></p>
<p class="toc level1 tocsp"><a href="nissetup-1.html">Part&nbsp;III&nbsp;NIS Setup and Administration</a></p>
<p class="toc level2"><a href="anis1-25461.html">4.&nbsp;&nbsp;Network Information Service (NIS) (Overview)</a></p>
<p class="toc level2"><a href="cnis1-25208.html">5.&nbsp;&nbsp;Setting Up and Configuring NIS Service</a></p>
<p class="toc level2"><a href="anis2-22217.html">6.&nbsp;&nbsp;Administering NIS (Tasks)</a></p>
<p class="toc level2"><a href="abtrbl-18694.html">7.&nbsp;&nbsp;NIS Troubleshooting</a></p>
<p class="toc level1 tocsp"><a href="ldapsetup-1.html">Part&nbsp;IV&nbsp;LDAP Naming Services Setup and Administration</a></p>
<p class="toc level2"><a href="overview-1.html">8.&nbsp;&nbsp;Introduction to LDAP Naming Services (Overview/Reference)</a></p>
<p class="toc level2"><a href="ldapsecure-1.html">9.&nbsp;&nbsp;LDAP Basic Components and Concepts (Overview)</a></p>
<p class="toc level2"><a href="planldap-1.html">10.&nbsp;&nbsp;Planning Requirements for LDAP Naming Services (Tasks)</a></p>
<p class="toc level2"><a href="sundssetup-13.html">11.&nbsp;&nbsp;Setting Up Sun Java System Directory Server With LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="clientsetup-1.html">12.&nbsp;&nbsp;Setting Up LDAP Clients (Tasks)</a></p>
<p class="toc level2"><a href="setupproblems-1.html">13.&nbsp;&nbsp;LDAP Troubleshooting (Reference)</a></p>
<p class="toc level2"><a href="schemas-1.html">14.&nbsp;&nbsp;LDAP General Reference (Reference)</a></p>
<p class="toc level2"><a href="nis2ldap-34.html">15.&nbsp;&nbsp;Transitioning From NIS to LDAP (Overview/Tasks)</a></p>
<p class="toc level2"><a href="nisplus2ldap-1.html">16.&nbsp;&nbsp;Transitioning From NIS+ to LDAP</a></p>
<p class="toc level3"><a href="nisplus2ldap-2.html">NIS+ to LDAP Overview</a></p>
<p class="toc level3"><a href="nisplus2ldap-5.html">Getting Started With the NIS+ to LDAP Transition</a></p>
<p class="toc level3"><a href="nisplus2ldap-41.html">Masters and Replicas (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-43.html">The Directory Server (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-49.html">Mapping NIS+ Objects Other Than Table Entries</a></p>
<p class="toc level3"><a href="nisplus2ldap-50.html">NIS+ Entry Owner, Group, Access, and TTL</a></p>
<p class="toc level3"><a href="nisplus2ldap-56.html">Principal Names and Netnames (NIS+ to LDAP)</a></p>
<p class="toc level3"><a href="nisplus2ldap-57.html"><tt>client_info</tt> and <tt>timezone</tt> Tables (NIS+ to LDAP)</a></p>
<div class="onpage">
<p class="toc level3"><a href="">Adding New Object Mappings (NIS+ to LDAP)</a></p>
</div>
<p class="toc level3"><a href="nisplus2ldap-70.html">Storing Configuration Information in LDAP</a></p>
<p class="toc level1 tocsp"><a href="ghnmu.html">Part&nbsp;V&nbsp;Active Directory Naming Service</a></p>
<p class="toc level2"><a href="ghnov.html">17.&nbsp;&nbsp;Setting Up Solaris Active Directory Clients</a></p>
<p class="toc level1 tocsp"><a href="whatsnew-1.html">A.&nbsp;&nbsp;Solaris 10 Software Updates to DNS, NIS, and LDAP</a></p>
<p class="toc level2"><a href="whatsnew-5.html">Service Management Facility Changes</a></p>
<p class="toc level2"><a href="whatsnew-2.html">DNS BIND</a></p>
<p class="toc level2"><a href="schemas-290.html"><tt>pam_ldap</tt> Changes</a></p>
<p class="toc level2"><a href="whatsnew-3.html">Documentation Errors</a></p>
<p class="toc level1 tocsp"><a href="aagloss-87604.html">Glossary</a></p>
<p class="toc level1 tocsp"><a href="idx-1.html">Index</a></p>
</td>
      <td class="ContentPane" width="705px">

	 <div class="MainContent">      	 
             

<a name="nisplus2ldap-60"></a><h3>Adding New Object Mappings (NIS+ to LDAP)</h3>
<p><a name="indexterm-599"></a>The template mapping file, <tt>/var/nis/NIS+LDAPmapping.template</tt>, contains mapping information for all standard NIS+
objects. In order to support mapping of site or application specific objects, you
will need to add new mapping entries. This is a simple task for
non-entry (that is, directory, group, link, or table) objects, but can become complex
for entry objects, if the LDAP organization of the corresponding entry data differs greatly
from that used by NIS+. The following example shows the simple case.</p>

<a name="nisplus2ldap-proc-61"></a><h4>How to Map Non-Entry Objects</h4><ol>
<li><a name="nisplus2ldap-step-62"></a><b>Find the fully qualified name of the object to be mapped.</b><p>If this name resides under the domain name specified by the <tt>nisplusLDAPbaseDomain</tt> attribute,
you can omit the portion that equals the <tt>nisplusLDAPbaseDomain</tt> value.</p><p>For example, if <tt>nisplusLDAPbaseDomain</tt> has the value <tt>some.domain.</tt>, and the object to
be mapped is a table called <tt>nodeinfo.some.domain.</tt>, the object name can be
shortened to <tt>nodeinfo</tt>.</p></li>
<li><a name="nisplus2ldap-step-63"></a><b>Invent a database id to identify the object.</b><p>The database id must be unique for the mapping configuration used, but is
not otherwise interpreted. It does not show up in the LDAP data. In
order to reduce confusion with entry object mappings, create a database id identifying
the table object proper (not the table entries) using an explanatory string like
<tt>_table</tt> at the end.</p><p>For this example, use the database id <tt>nodeinfo_table</tt>, and establish the connection between
the database id and the object in the standard mapping file location (<tt>/var/nis/NIS+LDAPmapping</tt>) by
adding the following.</p><pre>nisplusLDAPdatabaseIdMapping    nodeinfo_table:nodeinfo.some.domain.</pre><p>Assuming that <tt>nisplusLDAPbaseDomain</tt> is <tt>some.domain.</tt>, the following would also work.</p><pre>nisplusLDAPdatabaseIdMapping    nodeinfo_table:nodeinfo</pre></li>
<li><a name="nisplus2ldap-step-64"></a><b>Decide on a TTL for the object.</b><p>This is the time during which the <tt>rpc.nisd</tt> daemon regards its local copy
of the object as valid. When the TTL expires, the next reference to
the object will initiate an LDAP lookup to refresh the object.</p><p>There are two different TTL values. The first is set when the
<tt>rpc.nisd</tt> daemon first loads the object from disk (after a reboot or
restart), and the second pertains to all refreshes from LDAP. The first TTL
is selected randomly from a configured range. For example, if <tt>nodeinfo_table</tt> should be valid
for a period of between one and three hours following initial load, and
for twelve hours thereafter, specify the following.</p><pre>nisplusLDAPentryTtl        nodeinfo_table:3600:10800:43200</pre></li>
<li><a name="nisplus2ldap-step-65"></a><b>Decide where the object data should be stored in LDAP.</b><p>The template mapping file suggests putting non-entry object data in the <tt>ou=nisPlus</tt> container.</p><p>If you use this scheme, and have not yet created the appropriate
attribute, object class, and container, see <a href="nisplus2ldap-49.html">Mapping NIS+ Objects Other Than Table Entries</a>.</p><p>For example, assume you want to store the <tt>nodeinfo</tt> object in the <tt>ou=nisPlus,dc=some,dc=domain</tt>
container, and that the LDAP entry should have the <tt>cn nodeinfo</tt>. Create the following <tt>nisplusLDAPobjectDN</tt>.</p><pre>nisplusLDAPobjectDN    nodeinfo_table:\
                cn=nodeinfo,ou=nisPlus,dc=some,dc=domain?base?\
                objectClass=nisplusObjectContainer:\
                cn=nodeinfo,ou=nisPlus,dc=some,dc=domain?base?\
                    objectClass=nisplusObjectContainer,\
                    objectClass=top</pre><p>Since NIS+ replicas do not write data to LDAP, you can use
the <tt>nisplusLDAPobjectDN</tt> above for both master and replicas.</p></li>
<li><a name="nisplus2ldap-step-66"></a><b>(Skip this step if the NIS+ object to be mapped has not yet
been created in NIS+.) Store the object data in LDAP. You could use
the <tt>rpc.nisd</tt> daemon for this purpose, but it is easier to use the
<a href="http://docs.sun.com/doc/819-2240/nisldapmaptest-1m?a=view"><tt>nisldapmaptest</tt>(1M)</a> utility, as you can leave the <tt>rpc.nisd</tt> daemon running.</b><pre># <tt><b>nisldapmaptest</b></tt> <tt>-m</tt> <tt><b>/var/nis/NIS+LDAPmapping</b></tt> <tt>-o</tt> <tt><b></b></tt><tt>-t</tt> <tt><b>nodeinfo</b></tt> <tt>-r</tt><tt><b></b></tt></pre><p>The <tt>-o</tt> option specifies the table object itself, not the table entries.</p></li>
<li><a name="nisplus2ldap-step-67"></a><b>Verify that the object data is stored in LDAP. (This example assumes the
LDAP server is running on the local machine at port <tt>389</tt>.)</b><pre># <tt><b>ldapsearch</b></tt> <tt>-b</tt> <tt><b>ou=nisPlus,dc=some,dc=domain cn=nodeinfo</b></tt></pre><p>The output would appear similar to the following.</p><pre>dn: cn=nodeinfo,ou=nisPlus,dc=some,dc=domain
objectclass: nisplusObjectContainer
objectclass: top
cn: nodeinfo
nisplusobject=&lt;<i>base 64 encoded data</i>&gt;</pre></li>
<li><a name="nisplus2ldap-step-68"></a><b>Restart the NIS+ service.</b><p>The service will start by using the new mapping information. Do not forget
to edit the <tt>/lib/svc/method/nisplus</tt> file to add the <tt>-m</tt> and <tt>-Y</tt> options, or
use the <tt>svcprop</tt> command, as appropriate. See <a href="nisplus2ldap-2.html#nisplus2ldap-66">NIS+ to LDAP Tools and the Service Management Facility</a> for more information.</p><pre># <tt><b>svcadm restart network/rpc/nisplus:default</b></tt></pre></li></ol>

<a name="nisplus2ldap-69"></a><h4>Adding Entry Objects</h4>
<p><a href="http://docs.sun.com/doc/819-2251/nis-plus-ldapmapping-4?a=view"><tt>NIS+LDAPmapping</tt>(4)</a> specifies the syntax and semantics of table entry mapping in detail, and
also provides examples that show how to use each syntactic element. However, the
simplest and least error-prone approach is usually to identify an already existing mapping
that is similar to what you want to do, and then copy and
modify that existing mapping.</p><p>For example, assume that you have an NIS+ table called <tt>nodeinfo</tt>, which is
used to store inventory and owner information for nodes. Assume that the NIS+
table was created by the following command.</p><pre># <tt><b>nistbladm</b></tt> <tt>-c</tt> <tt><b></b></tt><tt>-D</tt> <tt><b>access=og=rmcd,nw=r</b></tt> <tt>-s</tt> <tt><b>: nodeinfo_tbl \</b></tt>
<tt><b>cname=S inventory=S owner= nodeinfo.`domainname`.</b></tt></pre><p>The <tt>cname</tt> column is expected to contain the canonical name of the node.
In other words, the same value as that of the <tt>cname</tt> column in
the <tt>hosts.org_dir</tt> table for the node.</p><p>Also assume that the corresponding information is kept in the <tt>ou=Hosts</tt> container
in LDAP, and that the <tt>nodeInfo</tt> object class (which is an invention for
this example, and is not defined in any RFC) has <tt>cn</tt> as a
MUST attribute, and that <tt>nodeInventory</tt> and <tt>nodeOwner</tt> are MAY attributes.</p><p>In order to upload existing <tt>nodeinfo</tt> data to LDAP, it will be convenient
to create the new mapping attributes in a separate file. You could, for
example, use <tt>/var/nis/tmpmapping</tt>.</p>
<ol><li><p>Create a database id that identifies the NIS+ table to be mapped.</p><pre>nisplusLDAPdatabaseIdMapping    nodeinfo:nodeinfo</pre></li>
<li><p>Set the TTL for entries in the <tt>nodeinfo</tt> table. Since the information is expected to change only rarely, use a twelve hour TTL. When the <tt>rpc.nisd</tt> daemon first loads the <tt>nodeinfo</tt> table from disk, the TTLs for entries in the table are randomly selected to be between six and twelve hours.</p><pre>nisplusLDAPentryTtl        nodeinfo:21600:43200:43200</pre></li>
<li><p>Identify an existing mapping that has similar properties to the one you want to create. In this example, mapping the attribute values is trivial (straight assignment). Instead, the complication is that you store the LDAP data in an existing container, so that you have to be careful during removal of the <tt>nodeinfo</tt> data. You do not want to remove the entire <tt>ou=Hosts</tt> entry, just the <tt>nodeInventory</tt> and <tt>nodeOwner</tt> attributes. You will need a special deletion rule set for this purpose.</p><p>To summarize, you are looking for a mapping that shares a container, and has a delete rule set. One possible candidate is the <tt>netmasks</tt> mapping, which shares the <tt>ou=Networks</tt> container, and does have a delete rule set.</p></li>
<li><p>The template <tt>netmasks</tt> mapping has the default mapping (from <tt>/var/nis/NIS+LDAPmapping.template</tt>) as follows.</p><pre>nisplusLDAPobjectDN    netmasks:ou=Networks,?one?objectClass=ipNetwork,\
           ipNetMaskNumber=*:\
              ou=Networks,?one?objectClass=ipNetwork:
              dbid=netmasks_del</pre><p>Transferred to the new mapping for <tt>nodeinfo</tt>, the database id should be <tt>nodeinfo</tt>, the container <tt>ou=Hosts</tt>, and the object class <tt>nodeInfo</tt>. Thus, the first line of the <tt>nodeinfo</tt> mapping becomes the following.</p><pre>nisplusLDAPobjectDN    nodeinfo:ou=Hosts,?one?objectClass=nodeInfo,\</pre><p>The second line in the <tt>netmasks</tt> mapping is the part of the search filter that selects only those <tt>ou=Networks</tt> entries that contain the <tt>ipNetMaskNumber</tt> attribute. In this example, select the <tt>ou=Hosts</tt> entries that have the following <tt>nodeInventory</tt> attribute.</p><pre>nodeInventory=*:\</pre><p>The third and fourth lines are the write portion of the <tt>nisplusLDAPobjectDN</tt>, and they specify where in LDAP <tt>nodeinfo</tt> data is written, as well as the rule set that is used when <tt>nodeinfo</tt> data is deleted. In this case, create a delete rule set identified by the database id <tt>nodeinfo_del</tt>. Because you are always writing to an existing entry in <tt>ou=Hosts</tt>, you only need to specify the object class for the <tt>nodeinfo</tt> data proper as follows.</p><pre>ou=Hosts,?one?objectClass=nodeInfo:\
                  dbid=nodeinfo_del
    </pre><p>Putting it all together, our <tt>nisplusLDAPobjectDN</tt> is the following.</p><pre>nisplusLDAPobjectDN    nodeinfo:ou=Hosts,?one?objectClass=nodeInfo,\
              nodeInventory=*:\
                  ou=Hosts,?one?objectClass=nodeInfo:\
                  dbid=nodeinfo_del</pre></li>
<li><p>Create the rule set that maps <tt>nodeinfo</tt> data from NIS+ to LDAP. The template (from <tt>netmasks</tt>) is the following.</p><pre>nisplusLDAPattributeFromColumn \
        netmasks:    dn=("ipNetworkNumber=%s,", addr), \
                        ipNetworkNumber=addr, \
                        ipNetmaskNumber=mask, \
                        description=comment</pre><p>The <tt>ou=Hosts</tt> container has an additional complication in this case, as RFC 2307 specifies the <tt>dn</tt> should contain the IP address. However, the IP address is not stored in the <tt>nodeinfo</tt> table, so you must obtain it in another manner. Fortunately, the <tt>crednode</tt> mapping in the template file shows how to obtain the IP address.</p><pre>nisplusLDAPattributeFromColumn \
   crednode:    dn=("cn=%s+ipHostNumber=%s,", \
                                (cname, "%s.*"), \
   ldap:ipHostNumber:?one?("cn=%s", (cname, "%s.*"))), \</pre><p>Thus, you can copy that portion of the <tt>crednode</tt> mapping. In this case, however, the <tt>cname</tt> column value is the actual host name (not the principal name), so you do not need to extract just a portion of the <tt>cname</tt>. Making the obvious substitutions of attribute and column names, the <tt>nodeinfo</tt> mapping becomes the following.</p><pre>nisplusLDAPattributeFromColumn \
   nodeinfo:    dn=("cn=%s+ipHostNumber=%s,", cname, \
   ldap:ipHostNumber:?one?("cn=%s", cname)), \
           nodeInventory=inventory, \
           nodeOwner=owner</pre></li>
<li><p>When mapping data from LDAP to NIS+, the template <tt>netmasks</tt> entry is as follows.</p><pre>nisplusLDAPcolumnFromAttribute \
        netmasks:    addr=ipNetworkNumber, \
                mask=ipNetmaskNumber, \
                comment=description</pre><p>After substituting attribute and column names, this result is the following.</p><pre>nisplusLDAPcolumnFromAttribute \
        nodeinfo:    cname=cn, \
                inventory=nodeInventory, \
                owner=nodeOwner</pre></li>
<li><p>The delete rule set for <tt>netmasks</tt> is as follows.</p><pre>nisplusLDAPattributeFromColumn \
        netmasks_del:    dn=("ipNetworkNumber=%s,", addr), \
                ipNetmaskNumber=</pre><p>The above specifies that when a <tt>netmasks</tt> entry is deleted in NIS+, the <tt>ipNetmaskNumber</tt> attribute in the corresponding <tt>ou=Networks</tt> LDAP entry is deleted. In this case, delete the <tt>nodeInventory</tt> and <tt>nodeOwner</tt> attributes. Therefore, using the <tt>dn</tt> specification from item (5) above, results in the following.</p><pre>nisplusLDAPattributeFromColumn \
        nodeinfo_del:    dn=("cn=%s+ipHostNumber=%s,", cname, \
            ldap:ipHostNumber:?one?("cn=%s", cname)), \
                nodeInventory=, \
                nodeOwner=</pre><p>The mapping information is complete.</p></li>
<li><p>The mapping information is complete. In order to begin using it, stop and later start the <tt>rpc.nisd</tt> daemon.</p><pre># <tt><b>pkill rpc.nisd</b></tt></pre></li>
<li><p>Stop, and later start, the NIS+ service, to begin using the mapping file.</p><pre># <tt><b>svcadm disable network/rpc/nisplus:default</b></tt></pre></li>
<li><p>If data is already in the NIS+ <tt>nodeinfo</tt> table, upload that data to LDAP. Put the new <tt>nodeinfo</tt> mapping information into a separate file, <tt>/var/nis/tmpmapping</tt>.</p><pre># <tt><b>/usr/sbin/rpc.nisd -D -m /var/nis/tmpmapping \</b></tt>
<tt><b>-x nisplusLDAPinitialUpdateAction=to_ldap \</b></tt>
<tt><b>-x nisplusLDAPinitialUpdateOnly=yes</b></tt></pre></li>
<li><p>Add the mapping information from the temporary file, <tt>/var/nis/tmpmapping</tt>, to the actual mapping file. Use an editor to do this, or append the data (assuming the actual mapping file is <tt>/var/nis/NIS+LDAPmapping</tt>) as follows.</p><pre># <tt><b>cp -p /var/nis/NIS+LDAPmapping \</b></tt>
<tt><b>/var/nis/NIS+LDAPmapping.backup</b></tt></pre><pre># <tt><b>cat /var/nis/tmpmapping &gt;&gt; /var/nis/NIS+LDAPmapping</b></tt></pre>
<hr><p><b>Caution - </b>Note the double arrow redirection, &ldquo;&gt;&gt;&rdquo;. A single arrow, &ldquo;&gt;&rdquo;, would overwrite the target file.</p>
<hr>
</li>
<li><p>Add the <tt>-m</tt> option to the <tt>/lib/svc/method/nisplus</tt> file. Also add the <tt>-Y</tt> or <tt>-B</tt> options as needed. See <a href="nisplus2ldap-2.html#nisplus2ldap-66">NIS+ to LDAP Tools and the Service Management Facility</a> for more information.</p></li>
<li><p>Start the NIS+ service.</p><pre># <tt><b>svcadm enable network/rpc/nisplus:default</b></tt></pre></li>
<li><p>Restart the <tt>rpc.nisd</tt> daemon. Add the <tt>-Y</tt> option if the <tt>rpc.nisd</tt> daemon also serves NIS (YP) data as follows.</p><pre># <tt><b>/usr/sbin/rpc.nisd -m /var/nis/NIS+LDAPmapping</b></tt></pre></li></ol>

         </div>
      </td>
   </tr>

   <tr class="PageControls" valign="top">
      <td></td>
      <td>
         <table width="100%">
      	   <tr>
      	     <td>
                 <a href="nisplus2ldap-57.html">Previous</a>
             </td>
             <td align="right">
                 <a href="nisplus2ldap-70.html">Next</a>
             </td>
           </tr>
         </table>
      </td>
   </tr>
</tbody>
</table>


</body>
</html>

