<chapter id="z.pkginst.ov-1"><title>About Packages and Patches on a Solaris
System With Zones Installed (Overview)</title><highlights><para>This chapter discusses maintaining the Solaris Operating System when
zones are installed. Information about adding packages and patches to the
operating system in the global zone and in all installed non-global zones
is provided. Information about removing packages and patches is also included.
The material in this chapter supplements the existing Solaris installation
and patch documentation. See the Solaris Express Release and Installation
Collection and <olink targetdoc="sysadv1" remap="external"><citetitle remap="book">System Administration Guide: Basic Administration</citetitle></olink> for more information.</para><para>This chapter covers the following topics:</para><itemizedlist><listitem><para><olink targetptr="z.pkginst.ov-4" remap="internal">Packaging and Patch Tools
Overview</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-10" remap="internal">About Packages and Zones</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-11" remap="internal">Keeping Zones in Sync</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-14" remap="internal">About Adding Packages in
Zones</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-23" remap="internal">About Removing Packages
in Zones</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-47" remap="internal">Package Parameter Information</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-22" remap="internal">Package Information Query</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-18" remap="internal">About Adding Patches in
Zones</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-29" remap="internal">Applying Patches on a Solaris
System With Zones Installed</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-24" remap="internal">Removing Patches on a Solaris
System With Zones Installed</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-20" remap="internal">PatchPro Support</olink></para>
</listitem><listitem><para><olink targetptr="z.pkginst.ov-19" remap="internal">Product Database</olink></para>
</listitem>
</itemizedlist>
</highlights><sect1 id="z.pkginst.ov-4"><title>Packaging and Patch Tools Overview</title><para>The Solaris packaging tools are used in administering the zones
environment. The global administrator can upgrade the system to a new version
of Solaris, which updates both the global and the non-global zones.</para><para>Solaris Live Upgrade , the standard Solaris interactive installation
program, or the custom Solaris JumpStart installation program can be used
in the global zone to upgrade a system that includes non-global zones.</para><para>The zone administrator can use the packaging tools to administer any
software installed in a non-global zone, within the limits described in this
document.</para><para>The following general principles apply when zones are installed:</para><itemizedlist><listitem><para>The global administrator can administer the software on every
zone on the system.</para>
</listitem><listitem><para>The root file system for a non-global zone can be administered
from the global zone by using the Solaris packaging and patch tools. The Solaris
packaging and patch tools are supported within the non-global zone for administering
co-packaged (bundled), standalone (unbundled), or third-party products.</para>
</listitem><listitem><para>The packaging and patch tools work in a zones-enabled environment.
The tools allow a package or patch installed in the global zone to also be
installed in a non-global zone.</para>
</listitem><listitem><para>The <literal>SUNW_PKG_ALLZONES</literal> package parameter
defines the <emphasis>zone scope</emphasis> of a package. The scope determines
the type of zone in which an individual package can be installed. For more
information about this parameter, see <olink targetptr="z.pkginst.ov-12" remap="internal">SUNW_PKG_ALLZONES
Package Parameter</olink>.</para>
</listitem><listitem><para>The <literal>SUNW_PKG_HOLLOW</literal> package parameter defines
the <emphasis>visibility</emphasis> of a package if that package is required
to be installed on all zones and be identical in all zones. For information
about this parameter, see <olink targetptr="z.pkginst.ov-36" remap="internal">SUNW_PKG_HOLLOW
Package Parameter</olink>.</para>
</listitem><listitem><para>The <literal>SUNW_PKG_THISZONE</literal> package parameter
defines whether a package must be installed in the current zone only. For
information about this parameter, see <olink targetptr="fmvet" remap="internal">SUNW_PKG_THISZONE
Package Parameter</olink>.</para>
</listitem><listitem><para>Packages that do not define values for zone package parameters
have a default setting of <literal>false</literal>.</para>
</listitem><listitem><para>The packaging information visible from within a non-global
zone is consistent with the files that have been installed in that zone using
the Solaris packaging and patch tools. The visibility includes packages that
have been imported  from the global zone using read-only loopback mounts.
See <olink targetptr="z.conf.start-85" remap="internal">Configuring, Verifying, and Committing
a Zone</olink> for more information about this process.</para>
</listitem><listitem><para>A change, such as a patch or package added in the global zone,
can be pushed out to all of the zones. This feature maintains consistency
between the global zone and each non-global zone.</para>
</listitem><listitem><para>The package commands can add, remove, and interrogate packages.
The patch commands can add and remove patches.</para>
</listitem>
</itemizedlist><note><para>While certain package and patch operations are performed, a zone
is temporarily locked to other operations of this type. The system might also
confirm a requested operation with the administrator before proceeding.</para>
</note>
</sect1><sect1 id="z.pkginst.ov-10"><title>About Packages and Zones</title><para>Only a subset of the Solaris packages installed on the global zone are
completely replicated when a non-global zone is installed. For example, many
packages that contain the Solaris kernel are not needed in a non-global zone.
All non-global zones implicitly share the same Solaris kernel from the global
zone. However, even if a package's data is not required or is not of use in
a non-global zone, the knowledge that a package is installed in the global
zone might be required in a non-global zone. The information allows package
dependencies from the non-global zones to be properly resolved with the global
zone.</para><para>Packages have parameters that control how their content is distributed
and made visible on a system with non-global zones installed. The <literal>SUNW_PKG_ALLZONES</literal>, <literal>SUNW_PKG_HOLLOW</literal>, and <literal>SUNW_PKG_THISZONE</literal> package
parameters define the characteristics of packages on a system with zones installed.
If desired, system administrators can check these package parameter settings
to verify the package's applicability when applying or removing a package
in a zone environment. The <command>pkgparam</command> command can be used
to view the values for these parameters. For more information on parameters,
see <olink targetptr="z.pkginst.ov-47" remap="internal">Package Parameter Information</olink>.
See <olink targetptr="z.pkginst.task-10" remap="internal">Checking Package Parameter Settings
on a System with Zones Installed</olink> for usage instructions.</para><sect2 id="gcded"><title>Patches Generated for Packages</title><para>When
a patch is generated for any package, the parameters  must be set to the same
values as the original package.</para>
</sect2><sect2 id="gcddu"><title>Interactive Packages</title><para>Any
package that must be interactive, which means that it has a request script,
is added to the current zone only. The package is not propagated to any other
zone. If an interactive package is added to the global zone, the package is
treated as though it is being added by using the <command>pkgadd</command> command
with the <option>G</option> option. For more information about this option,
see <olink targetptr="z.pkginst.ov-14" remap="internal">About Adding Packages in Zones</olink>.</para>
</sect2>
</sect1><sect1 id="z.pkginst.ov-11"><title>Keeping Zones in Sync</title><para>It
is best to keep the software installed in the non-global zones in sync with
the software installed in the global zone to the maximum extent possible.
This practice minimizes the difficulty in administering a system with multiple
installed zones.</para><para>To achieve this goal, the package tools enforce the following rules
when adding or removing packages in the global zone.</para><sect2 id="z.pkginst.ov-38"><title>Package Operations Possible in the Global
Zone</title><para>If the package is not currently installed in the global zone and not
currently installed in any non-global zone, the package can be installed:</para><itemizedlist><listitem><para>Only in the global zone, if <literal>SUNW_PKG_ALLZONES=false</literal></para>
</listitem><listitem><para>In the current zone only, which is the global zone in this
case, if <literal>SUNW_PKG_THISZONE=true</literal></para>
</listitem><listitem><para>In the global zone and all non-global zones</para>
</listitem>
</itemizedlist><para>If the package is currently installed in the global zone only:</para><itemizedlist><listitem><para>The package can be installed in all non-global zones.</para>
</listitem><listitem><para>The package can be removed from the global zone.</para>
</listitem>
</itemizedlist><para>If a package is currently installed in the global zone and currently
installed in only a subset of the non-global zones:</para><itemizedlist><listitem><para><literal>SUNW_PKG_ALLZONES</literal> must be set to <literal>false</literal>.</para>
</listitem><listitem><para>The package can be installed in all non-global zones. Existing
instances in any non-global zone are updated to the revision being installed.</para>
</listitem><listitem><para>The package can be removed from the global zone.</para>
</listitem><listitem><para>The package can be removed from the global zone and from all
non-global zones.</para>
</listitem>
</itemizedlist><para>If a package is currently installed in the global zone and currently
installed in all non-global zones, the package can be removed from the global
zone and from all non-global zones.</para><para>These rules ensure the following:</para><itemizedlist><listitem><para>Packages installed in the global zone are either installed
in the global zone only, or installed in the global zone and all non-global
zones.</para>
</listitem><listitem><para>Packages installed in the global zone and also installed in
any non-global zone are the same across all zones.</para>
</listitem>
</itemizedlist>
</sect2><sect2 id="z.pkginst.ov-39"><title>Package Operations Possible in a Non-Global
Zone</title><para>The package operations possible in any non-global zone are:</para><itemizedlist><listitem><para>If a package is not currently installed in the non-global
zone, the package can be installed only if <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem><listitem><para>The package can be installed in the current zone, which is
the non-global zone in this case, if <literal>SUNW_PKG_THISZONE=true</literal>.</para>
</listitem><listitem><para>If a package is currently installed in the non-global zone:</para><itemizedlist><listitem><para>The package can be installed over the existing instance of
the package only if <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem><listitem><para>The package can be removed from the non-global zone only if <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist>
</sect2>
</sect1><sect1 id="gdzlv"><title>How Zone State Affects Patch and Package Operations</title><para>The following table describes what will happen when <command>pkgadd</command>, <command>pkgrm</command>, <command>patchadd</command>, and <command>patchrm</command> commands
are used on a system with non-global zones in various states.</para><informaltable frame="all"><tgroup cols="2" colsep="1" rowsep="1"><colspec colwidth="50*"/><colspec colwidth="50*"/><thead><row><entry><para>Zone State</para>
</entry><entry><para>Effect on Package and Patch Operations</para>
</entry>
</row>
</thead><tbody><row><entry><para>Configured</para>
</entry><entry><para>Patch and package tools can be run. No software has been installed yet.</para>
</entry>
</row><row><entry><para>Installed</para>
</entry><entry><para>Patch and package tools can be run. During patch or packaging operations,
the system moves a zone from the installed state to a new internal state called
mounted. After patching has completed, the zone is reverted back to the installed
state.</para><para>Note that immediately after <command>zoneadm</command> <option>z</option> <replaceable>zonename</replaceable> <literal>install</literal> has completed, the zone
is also moved to the installed state. A zone in the installed state that has
never been booted cannot be patched or run packaging commands. The zone must
be booted to the running state at least once. After a zone has been booted
at least once, and then moved back to the installed state by using <command>zoneadm</command> <literal>halt</literal>, then patch and packaging commands can
be run.</para>
</entry>
</row><row><entry><para>Ready</para>
</entry><entry><para>Patch and package tools can be run.</para>
</entry>
</row><row><entry><para>Running</para>
</entry><entry><para>Patch and package tools can be run.</para>
</entry>
</row><row><entry><para>Incomplete</para>
</entry><entry><para>A zone being installed or removed by <command>zoneadm</command>. Patch
and package tools cannot be used. The tools cannot bring the zone into the
appropriate state for using the tools.</para>
</entry>
</row>
</tbody>
</tgroup>
</informaltable>
</sect1><sect1 id="z.pkginst.ov-14"><title>About Adding Packages in Zones</title><para>The <command>pkgadd</command> system utility described in the <olink targetdoc="group-refman" targetptr="pkgadd-1m" remap="external"><citerefentry><refentrytitle>pkgadd</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man page
is used to add packages on a Solaris system with zones installed.</para><sect2 id="z.pkginst.ov-16"><title>Using <command>pkgadd</command> in the
Global Zone</title><para>The <command>pkgadd</command> utility can be used with the <option>G</option> option
in the global zone to add the package to the global zone only. The package
is not propagated to any other  zones. Note that if <literal>SUNW_PKG_THISZONE=true</literal>, you do not have to use the <option>G</option> option. If  <literal>SUNW_PKG_THISZONE=false</literal>, the <option>G</option> option will override it.</para><para>When you run the <command>pkgadd</command> utility in the global zone,
the following actions apply.</para><itemizedlist><listitem><para>The <command>pkgadd</command> utility is able to add a package:</para><itemizedlist><listitem><para>To the global zone only, unless the package is <literal>SUNW_PKG_ALLZONES=true</literal></para>
</listitem><listitem><para>To the global zone and to all non-global zones</para>
</listitem><listitem><para>To all non-global zones only, if the package is already installed
in the global zone</para>
</listitem><listitem><para>To the current zone only, if <literal>SUNW_PKG_THISZONE=true</literal></para>
</listitem>
</itemizedlist>
</listitem><listitem><para>The <command>pkgadd</command> utility cannot add a package:</para><itemizedlist><listitem><para>To any subset of the non-global zones</para>
</listitem><listitem><para>To all non-global zones, unless the package is already installed
in the global zone</para>
</listitem>
</itemizedlist>
</listitem><listitem><para>If the <command>pkgadd</command> utility is run without the <option>G</option> option and <literal>SUNW_PKG_THISZONE=false</literal> , the specified
package is added to all zones by default. The package is not marked as installed
in the global zone only.</para>
</listitem><listitem><para>If the <command>pkgadd</command> utility is run without the <option>G</option> option and <literal>SUNW_PKG_THISZONE=true</literal>, then the
specified package is added to the current (global) zone by default. The package
is marked as installed in the global zone only.</para>
</listitem><listitem><para>If the <option>G</option> option is used, the <command>pkgadd</command> utility
adds the specified package to the global zone only. The package is marked
as installed in the global zone only. The package is not installed when any
non-global zone is installed.</para>
</listitem>
</itemizedlist><sect3 id="z.pkginst.ov-41"><title>Adding a Package to the Global Zone and
to All Non-Global Zones</title><para>To add a package to the global zone and to all non-global zones, execute
the <command>pkgadd</command> utility in the global zone. As the global administrator,
run <command>pkgadd</command> without the <option>G</option> option.</para><para>A package can be added to the global zone and to all non-global zones
without regard to the area affected by the package.</para><para>The following steps are performed by the <command>pkgadd</command> utility:</para><itemizedlist><listitem><para>Package dependencies are checked on the global zone and on
all non-global zones. If required packages are not installed in any zone,
then the dependency check fails. The system notifies the global administrator,
who is prompted whether to continue.</para>
</listitem><listitem><para>The package is added to the global zone.</para>
</listitem><listitem><para>The package database on the global zone is updated.</para>
</listitem><listitem><para>The package is added to each non-global zone and the database
in the global zone is updated.</para>
</listitem><listitem><para>The package database on each non-global zone is updated.</para>
</listitem>
</itemizedlist>
</sect3><sect3 id="z.pkginst.ov-42"><title>Adding a Package to the Global Zone Only</title><para>To add a package to the global zone only, as the global administrator
in the global zone, execute the <command>pkgadd</command> utility with the <option>G</option> option only.</para><para>A package can be added to the global zone if the following conditions
are true:</para><itemizedlist><listitem><para>The package contents do not affect any area of the global
zone that is shared with any non-global zone.</para>
</listitem><listitem><para>The package is set <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem>
</itemizedlist><para>The following steps are performed by the <command>pkgadd</command> utility:</para><itemizedlist><listitem><para>If the package contents affect any area of the global zone
that is shared with any non-global zone, or if the package is set <literal>SUNW_PKG_ALLZONES=true</literal>, then <command>pkgadd</command> fails. The error message states
that the package must be added to the global zone and to all non-global zones.</para>
</listitem><listitem><para>Package dependencies are checked on the global zone only.
If required packages are not installed, then the dependency check fails. The
system notifies the global administrator, who is prompted whether to continue.</para>
</listitem><listitem><para>The package is added to the global zone.</para>
</listitem><listitem><para>The package database on the global zone is updated.</para>
</listitem><listitem><para>The package information on the global zone is annotated to
indicate that this package is installed on the global zone only. If a non-global
zone is installed in the future, this package will not be installed.</para>
</listitem>
</itemizedlist>
</sect3><sect3 id="z.pkginst.ov-43"><title>Adding a Package Installed in the Global
Zone to all Non-Global Zones</title><para>To add a package that is already installed in the global zone to all
non-global zones, you must currently remove the package from the global zone
and reinstall it in all zones.</para><para>These are the steps used to add a package that is already installed
in the global zone to all of the non-global zones:</para><orderedlist><listitem><para>In the global zone, use <command>pkgrm</command> to remove
the package.</para>
</listitem><listitem><para>Add  the package without using the <option>G</option> option.</para>
</listitem>
</orderedlist>
</sect3>
</sect2><sect2 id="z.pkginst.ov-15"><title>Using <command>pkgadd</command> in a Non-Global
Zone</title><para>To add a package in a specified non-global zone, execute the <command>pkgadd</command> utility, without options, as the zone administrator. The following
conditions apply:</para><itemizedlist><listitem><para>The <command>pkgadd</command> utility can only add packages
in the non-global zone in which the utility is used.</para>
</listitem><listitem><para>The package cannot affect any area of the zone that is shared
from the global zone.</para>
</listitem><listitem><para>The package must be set <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem>
</itemizedlist><para>The following steps are performed by the <command>pkgadd</command> utility:</para><itemizedlist><listitem><para>Package dependencies are checked on the non-global zone's
package database before the package is added. If required packages are not
installed, then the dependency check fails. The system notifies the non-global
zone administrator, who is prompted whether to continue. The check fails if
either of the following conditions are true.</para><itemizedlist><listitem><para>Any component of the package affects any area of the zone
that is shared from the global zone.</para>
</listitem><listitem><para>The package is set <literal>SUNW_PKG_ALLZONES=true</literal>.</para>
</listitem>
</itemizedlist>
</listitem><listitem><para>The package is added to the zone.</para>
</listitem><listitem><para>The package database on the zone is updated.</para>
</listitem>
</itemizedlist>
</sect2>
</sect1><sect1 id="z.pkginst.ov-23"><title>About Removing Packages in Zones</title><para>The <command>pkgrm</command> utility described in the <olink targetdoc="group-refman" targetptr="pkgrm-1m" remap="external"><citerefentry><refentrytitle>pkgrm</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man page supports removing
packages on a Solaris system with zones installed.</para><sect2 id="z.pkginst.ov-25"><title>Using <command>pkgrm</command> in the Global
Zone</title><para>The <command>pkgrm</command> utility can be used with the <option>G</option> option
from the global zone to remove packages from the global zone only. The package
must not affect any area of the global zone shared with non-global zones or
be installed in any non-global zone.</para><para>When the <command>pkgrm</command> utility is used in the global zone,
the following actions apply.</para><itemizedlist><listitem><para><command>pkgrm</command> can remove a package from the global
zone and from all non-global zones, or
from the global zone only when the package is only installed in the global
zone.</para>
</listitem><listitem><para><command>pkgrm</command> cannot remove a package only from
the global zone if the package is also installed in a non-global zone, or
remove a package from any subset of the non-global zones.</para>
</listitem>
</itemizedlist><para>Note that a package can only be removed from a non-global zone by a
zone administrator working in that zone if the following are true:</para><itemizedlist><listitem><para>The package does not affect any area on the non-global zone
that is shared from the global zone.</para>
</listitem><listitem><para>The package is set <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem>
</itemizedlist><sect3 id="z.pkginst.ov-44"><title>Removing a Package From the Global Zone
and From all Non-Global Zones</title><para>To remove a package from the global zone and from all non-global zones,
execute the <command>pkgrm</command> utility in the global zone. As the global
administrator, run <command>pkgrm</command> without the <option>G</option> option.</para><para>A package can be removed from the global zone and from all non-global
zones without regard to the area affected by the package.</para><para>The following steps are performed by the <command>pkgrm</command> utility:</para><itemizedlist><listitem><para>Package dependencies are checked on the global zone and on
all non-global zones. If the dependency check fails, then <command>pkgrm</command> fails.
The system notifies the global administrator, who is prompted whether to continue.</para>
</listitem><listitem><para>The package is removed from each non-global zone.</para>
</listitem><listitem><para>The package database on each non-global zone is updated.</para>
</listitem><listitem><para>The package is removed from the global zone.</para>
</listitem><listitem><para>The package database on the global zone is updated.</para>
</listitem>
</itemizedlist>
</sect3>
</sect2><sect2 id="z.pkginst.ov-26"><title>Using <command>pkgrm</command> in a Non-Global
Zone</title><para>As the zone administrator, use the <command>pkgrm</command> utility
in a non-global zone to remove a package. The following limitations apply:</para><itemizedlist><listitem><para><command>pkgrm</command> can only remove packages from the
non-global zone.</para>
</listitem><listitem><para>The <option>G</option> option cannot be used. If this option
is used, <command>pkgrm</command> outputs an error message and the attempted
operation fails.</para>
</listitem><listitem><para>The package cannot affect any area of the zone that is shared
from the global zone.</para>
</listitem><listitem><para>The package must be set <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem>
</itemizedlist><para>The following steps are performed by the <command>pkgrm</command> utility:</para><itemizedlist><listitem><para>Dependencies are checked on the non-global zone's package
database. If the dependency check fails, then <command>pkgrm</command> fails
and the zone administrator is notified. The check fails if either of the following
conditions are true.</para><itemizedlist><listitem><para>Any component of the package affects any area of the zone
that is shared from the global zone.</para>
</listitem><listitem><para>The package is set <literal>SUNW_PKG_ALLZONES=true</literal>.</para>
</listitem>
</itemizedlist>
</listitem><listitem><para>The package is removed from the zone.</para>
</listitem><listitem><para>The package database on the zone is updated.</para>
</listitem>
</itemizedlist>
</sect2>
</sect1><sect1 id="z.pkginst.ov-47"><title>Package Parameter Information</title><sect2 id="gcdex"><title>Setting Package Parameters for Zones</title><para>The <literal>SUNW_PKG_ALLZONES</literal>, <literal>SUNW_PKG_HOLLOW</literal>,
and <literal>SUNW_PKG_THISZONE</literal> package parameters define the characteristics
of packages on a system with zones installed. These parameters must be set
so that packages can be administered on a system with non-global zones installed.</para><para>The following table lists the four valid combinations for setting package
parameters. If you choose setting  combinations that are not listed in the
following table, those settings are invalid and the package will fail to install.</para><para>Ensure that you have set all three package parameters. You can leave
all three package parameters blank. The package tools interpret a missing
zone package parameter as if the setting were <literal>false</literal>, but
not setting the parameters is  strongly discouraged. By setting all three
package parameters, you specify the exact behavior the package tools should
exhibit when installing or removing the package.</para><table frame="topbot" id="z.pkginst.ov-99"><title>Valid Package Parameter
Settings</title><tgroup cols="4" colsep="0" rowsep="0"><colspec colwidth="27*"/><colspec colwidth="23*"/><colspec colwidth="25*"/><colspec colwidth="46*"/><thead><row rowsep="1"><entry><para><literal>SUNW_PKG_ALLZONES</literal> Setting</para>
</entry><entry><para><literal>SUNW_PKG_HOLLOW</literal> Setting</para>
</entry><entry><para><literal>SUNW_PKG_THISZONE</literal> Setting</para>
</entry><entry><para>Package Description</para>
</entry>
</row>
</thead><tbody><row><entry><para>false</para>
</entry><entry><para>false</para>
</entry><entry><para>false</para>
</entry><entry><para>This is the default setting for packages that do not specify values
for all the zone package parameters.</para><para>A package with these settings can be installed in either the global
zone or a non-global zone. </para><itemizedlist><listitem><para>If the <command>pkgadd</command> command is run in the  global
zone, the package is installed in the global zone and in all non-global  zones.</para>
</listitem><listitem><para>If the <command>pkgadd</command> command is run in a  non-global
zone, the package is installed in the non-global zone only. </para>
</listitem>
</itemizedlist><para>In both cases, the entire contents of the package is visible in all
zones where the package is installed.</para>
</entry>
</row><row><entry><para>false</para>
</entry><entry><para>false</para>
</entry><entry><para>true</para>
</entry><entry><para>A package with these settings can be installed in either the global
zone or a non-global zone. If new non-global zones are created after the 
installation, the package is not propagated to these new non-global zones.</para><itemizedlist><listitem><para>If the <command>pkgadd</command> command is run in the  global
zone, the package is installed in the global zone only.</para>
</listitem><listitem><para>If the <command>pkgadd</command> command is run in a  non-global
zone, the package is installed in the non-global zone  only.</para>
</listitem>
</itemizedlist><para> In both cases, the entire contents of the package is visible in the
zone where the package is installed.</para>
</entry>
</row><row><entry><para>true</para>
</entry><entry><para>false</para>
</entry><entry><para>false</para>
</entry><entry><para>A package with these settings can be installed in the global zone  only.
When the <command>pkgadd</command> command is run, the package is installed
in the global zone and in all non-global zones. The entire contents of the
package is visible in all zones.</para><note><para>Any attempt to install the package in a non-global zone  fails.</para>
</note>
</entry>
</row><row><entry><para>true</para>
</entry><entry><para>true</para>
</entry><entry><para>false</para>
</entry><entry><para>A package with these settings can only be installed in the global  zone,
by the global administrator.  When the <command>pkgadd</command> command is
run, the contents of the package is fully installed in the global zone. If
a package has the package parameters set to these values, the package  content
itself is not delivered on any non-global zone. Only the package  installation
information necessary to make the package appear to be installed is  installed
on all non-global zones. This enables the installation of other packages to
be installed that depend on this package.</para><para>For package dependency checking purposes, the package appears to be
installed in all zones.</para><itemizedlist><listitem><para>In the global zone, the entire contents of the package is
visible.</para>
</listitem><listitem><para>In whole root non-global zones, the entire contents of the
package is not visible.</para>
</listitem><listitem><para>When a non-global zone inherits a file system from the  global
zone, a package installed in this file system is visible in a non-global 
zone. All other files delivered by the package are not visible within the
 non-global zone. </para><para>For example, a sparse root non-global zone
shares certain directories with the global zone. These directories are read-only.
Sparse root non-global zones share the <filename>/platform</filename> file
system among others. Another example is packages that deliver files relevant
only to booting hardware.</para>
</listitem>
</itemizedlist><note><para>Any attempt to install the package in a non-global zone fails.</para>
</note>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2><sect2 id="z.pkginst.ov-12"><title><literal>SUNW_PKG_ALLZONES</literal> Package
Parameter</title><para>The optional <literal>SUNW_PKG_ALLZONES</literal> package parameter
describes the zone scope of a package. This parameter defines the following:</para><itemizedlist><listitem><para>Whether a package is required to be installed on all zones</para>
</listitem><listitem><para>Whether a package is required to be identical in all zones</para>
</listitem>
</itemizedlist><para>The <literal>SUNW_PKG_ALLZONES</literal> package parameter has two permissible
values. These values are <literal>true</literal> and <literal>false</literal>.
The default value is <literal>false</literal>. If this parameter is either
not set or set to a value other than <literal>true</literal> or <literal>false</literal>,
the value <literal>false</literal> is used.</para><para>The <literal>SUNW_PKG_ALLZONES</literal> parameter should be set to <literal>true</literal> for packages that <emphasis>must</emphasis> be the same package
version and patch revision level across all zones. Any package that delivers
functionality dependent on a particular Solaris kernel, for example, Solaris
10, should set this parameter to <literal>true</literal>. Any patch for a
package must set the <literal>SUNW_PKG_ALLZONES</literal>parameter to the
same value that is set in the installed package being patched. The patch revision
level for any package that sets this parameter to <literal>true</literal> must
be the same across all zones.</para><para>Packages that deliver functionality not dependent on a particular Solaris
kernel, such as third-party packages or Sun compilers, should set this parameter
to <literal>false</literal>. Any patch for a package that sets this parameter
to <literal>false</literal> must also set this parameter to <literal>false</literal>.
Both the package version or the patch revision level for any package that
sets this parameter to <literal>false</literal> can be different between zones.
For example, two non-global zones could each have a different version of a
web server installed.</para><para>The <literal>SUNW_PKG_ALLZONES</literal> package parameter values are
described in the following table.</para><table frame="all" id="z.pkginst.ov-tbl-13"><title><literal>SUNW_PKG_ALLZONES</literal> Package
Parameter Values</title><tgroup cols="2" colsep="1" rowsep="1"><colspec colwidth="25*"/><colspec colwidth="75*"/><thead><row><entry><para>Value</para>
</entry><entry><para>Description</para>
</entry>
</row>
</thead><tbody><row><entry><para><literal>false</literal></para>
</entry><entry><para>This package can be installed from the global zone to the global zone
 only, or to the global zone and to all non-global zones. The package can
also  be installed from any non-global zone to the same non-global zone.</para><itemizedlist><listitem><para>The global administrator can install the package on the global
zone only.</para>
</listitem><listitem><para>The global administrator can install the package on the global
zone and on all non-global zones.</para>
</listitem><listitem><para>The zone administrator can install the package on a non-global
zone.</para>
</listitem>
</itemizedlist><para>If removed from the global zone, the package is not removed from other
zones. The package can be removed from individual non-global zones.</para><itemizedlist><listitem><para>The package is not required to be installed on the global
zone.</para>
</listitem><listitem><para>The package is not required to be installed on any non-global
zone.</para>
</listitem><listitem><para>The package is not required to be  identical across all zones.
Different versions of the package can exist on individual zones.</para>
</listitem><listitem><para>The package delivers software that is not implicitly shared
across all zones. This means that the package is not operating system-specific.
Most application-level software is in this category. Examples include the <trademark>StarOffice</trademark> product or a web server.</para>
</listitem>
</itemizedlist>
</entry>
</row><row><entry><para><literal>true</literal></para>
</entry><entry><para>If installed on the global zone, this package must also be installed
on all non-global zones. If removed from the global zone, the package must
also be removed from all non-global zones.</para><itemizedlist><listitem><para>If the package is installed, it must be installed on the global
zone. The package is then automatically installed on all non-global zones.</para>
</listitem><listitem><para>The version of the package must be identical on all zones.</para>
</listitem><listitem><para>The package delivers software that is implicitly shared across
all zones. The package is dependent on the versions of software that are implicitly
shared across all zones. The package should be visible in all non-global zones.
Examples include kernel modules.</para><para>These packages allow the non-global
zone to resolve dependencies on packages that are installed in the global
zone by requiring that the entire package  be installed on all non-global
zones.</para>
</listitem><listitem><para>Only the global administrator can install the package. A zone
administrator cannot install the package on a non-global zone.</para>
</listitem>
</itemizedlist>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2><sect2 id="z.pkginst.ov-36"><title><literal>SUNW_PKG_HOLLOW</literal> Package
Parameter</title><para>The <literal>SUNW_PKG_HOLLOW</literal> package parameter defines
whether a package should be visible in any non-global zone if that package
is required to be installed and be identical in all zones.</para><para>The <literal>SUNW_PKG_HOLLOW</literal> package parameter has two permissible
values, <literal>true</literal> or <literal>false</literal>.</para><itemizedlist><listitem><para>If <literal>SUNW_PKG_HOLLOW</literal> is either not set or
set to a value other than <literal>true</literal> or <literal>false</literal>,
the value <literal>false</literal> is used.</para>
</listitem><listitem><para>If <literal>SUNW_PKG_ALLZONES</literal> is set to <literal>false</literal>,
the <literal>SUNW_PKG_HOLLOW</literal> parameter is ignored.</para>
</listitem><listitem><para>If <literal>SUNW_PKG_ALLZONES</literal> is set to <literal>false</literal>,
then <literal>SUNW_PKG_HOLLOW</literal> cannot be set to <literal>true</literal>.</para>
</listitem>
</itemizedlist><para>The <literal>SUNW_PKG_HOLLOW</literal> package parameter values are
described in the following table.</para><table frame="all" id="z.pkginst.ov-tbl-37"><title><literal>SUNW_PKG_HOLLOW</literal> Package
Parameter Values</title><tgroup cols="2" colsep="1" rowsep="1"><colspec colwidth="30*"/><colspec colwidth="70*"/><thead><row><entry><para>Value</para>
</entry><entry><para>Description</para>
</entry>
</row>
</thead><tbody><row><entry><para><literal>false</literal></para>
</entry><entry><para>This is not a &ldquo;hollow&rdquo; package:</para><itemizedlist><listitem><para>If installed on the global zone, the package content and installation
information are required on all non-global zones.</para>
</listitem><listitem><para>The package delivers software that should be visible in all
non-global zones. An example is the package that delivers the <command>truss</command> command.</para>
</listitem><listitem><para>Other than the restrictions for the current setting of the <literal>SUNW_PKG_ALLZONES</literal> package parameter, no additional restrictions
are defined.</para>
</listitem>
</itemizedlist>
</entry>
</row><row><entry><para><literal>true</literal></para>
</entry><entry><para>This is a &ldquo;hollow&rdquo; package:</para><itemizedlist><listitem><para>The package content is not delivered on any non-global zone.
However, the package installation information is required on all non-global
zones.</para>
</listitem><listitem><para>The package delivers software that should not be visible in
all non-global zones. Examples include kernel drivers and system configuration
files that work only in the global zone. This setting allows the non-global
zone to resolve dependencies on packages that are installed only on the global
zone without actually installing the package data.</para>
</listitem><listitem><para>The package is recognized as being installed in all zones
for purposes of dependency checking by other packages that rely on this package
being installed.</para>
</listitem><listitem><para>This package setting includes all of the restrictions defined
for setting <literal>SUNW_PKG_ALLZONES</literal> to <literal>true</literal>.</para>
</listitem><listitem><para>In the global zone, the package is recognized as having been
installed, and all components of the package are installed. Directories are
created, files are installed, and class action and other scripts are run as
appropriate when the package is installed.</para>
</listitem><listitem><para>In a non-global zone, the package is recognized as having
been installed, but no components of the package are installed. No directories
are created, no files are installed, and no class action or other install
scripts are run when the package is installed.</para>
</listitem><listitem><para>When the package is removed from the global zone, the system
recognizes that the package was completely installed. Appropriate directories
and files are removed, and class action or other install scripts are run when
the package is removed.</para>
</listitem>
</itemizedlist>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2><sect2 id="fmvet"><title><literal>SUNW_PKG_THISZONE</literal> Package Parameter</title><para>The <literal>SUNW_PKG_THISZONE</literal> package parameter defines
whether a package must be installed in the current zone, global or non-global,
only. The <literal>SUNW_PKG_THISZONE</literal> package parameter has two permissible
values. These values are <literal>true</literal> and <literal>false</literal>.
The default value is <literal>false</literal>. </para><para>The <literal>SUNW_PKG_THISZONE</literal> package parameter values are
described in the following table.</para><table frame="all" id="fmveu"><title><literal>SUNW_PKG_THISZONE</literal> Package
Parameter Values</title><tgroup cols="2" colsep="1" rowsep="1"><colspec colwidth="30*"/><colspec colwidth="70*"/><thead><row><entry><para>Value</para>
</entry><entry><para>Description</para>
</entry>
</row>
</thead><tbody><row><entry><para><literal>false</literal></para>
</entry><entry><itemizedlist><listitem><para>If <literal>pkgadd</literal> is run in a non-global zone,
the package is installed in the current zone only.</para>
</listitem><listitem><para>If <literal>pkgadd</literal> is run in the global zone, the
package is installed in the global zone and also installed in all currently
installed non-global zones. In addition, the package will be propagated to
all future, newly installed non-global zones.</para>
</listitem>
</itemizedlist>
</entry>
</row><row><entry><para><literal>true</literal></para>
</entry><entry><itemizedlist><listitem><para>The package is installed in the current zone only.</para>
</listitem><listitem><para> If installed in the global zone, the package is not added
to any currently existing or yet-to-be-created non-global zones. This is the
same behavior that occurs when the <option>G</option> option is specified
to <literal>pkgadd</literal>.  </para>
</listitem>
</itemizedlist>
</entry>
</row>
</tbody>
</tgroup>
</table>
</sect2>
</sect1><sect1 id="z.pkginst.ov-22"><title>Package Information Query</title><para>The <command>pkginfo</command> utility described in the <olink targetdoc="group-refman" targetptr="pkginfo-1" remap="external"><citerefentry><refentrytitle>pkginfo</refentrytitle><manvolnum>1</manvolnum></citerefentry></olink> man page supports
querying the software package database on a Solaris system with zones installed.
For information about the database, see <olink targetptr="z.pkginst.ov-19" remap="internal">Product
Database</olink>.</para><para>The <command>pkginfo</command> utility can be used in the global zone
to query the software package database in the global zone only. The <command>pkginfo</command> utility can be used in a non-global zone to query the software
package database in the non-global global zone only.</para>
</sect1><sect1 id="z.pkginst.ov-18"><title>About Adding Patches in Zones</title><para>In general, a patch consists of the following components:</para><itemizedlist><listitem><para>Patch information:</para><itemizedlist><listitem><para>Identification, which is the patch version and patch ID</para>
</listitem><listitem><para>Applicability, which is the operating system type, operating
system version, and architecture</para>
</listitem><listitem><para>Dependencies, such as requires and obsoletes</para>
</listitem><listitem><para>Properties, such as requires a reboot afterwards</para>
</listitem>
</itemizedlist>
</listitem><listitem><para>One or more packages to patch, where each package contains:</para><itemizedlist><listitem><para>The version of the package to which the patches can be applied</para>
</listitem><listitem><para>Patch information, such as ID, obsoletes, and requires</para>
</listitem><listitem><para>One or more components of the package to be patched</para>
</listitem>
</itemizedlist>
</listitem>
</itemizedlist><para>When the <command>patchadd</command> command is used to apply a patch,
the patch information is used to determine whether the patch is applicable
to the currently running system. If determined to be not applicable, the patch
is not applied. Patch dependencies are also checked against all of the zones
on the system. If any required dependencies are not met, the patch is not
applied. This could include the case in which a later version of the patch
is already installed.</para><para>Each package contained in the patch is checked. If the package is not
installed on any zone, then the package is bypassed and not patched.</para><para>If all dependencies are satisfied, all packages in the patch that are
installed on any zone are used to patch the system. The package and patch
databases are also updated.</para>
</sect1><sect1 id="z.pkginst.ov-29"><title>Applying Patches on a Solaris System With
Zones Installed</title><para>All patches applied at the global zone level are applied across all
zones. When a non-global zone is installed, it is at the same patch level
as the global zone. When the global zone is patched, all non-global zones
are similarly patched. This action maintains the same patch level across all
zones.</para><para>The <command>patchadd</command> system utility described in the <olink targetdoc="group-refman" targetptr="patchadd-1m" remap="external"><citerefentry><refentrytitle>patchadd</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man page
is used to add patches on a system with zones installed.</para><sect2 id="z.pkginst.ov-32"><title>Using <command>patchadd</command> in the
Global Zone</title><para>To add a patch to the global zone and to all non-global zones, run <command>patchadd</command> as the global administrator in the global zone.</para><para>When <command>patchadd</command> is used in the global zone, the following
conditions apply:</para><itemizedlist><listitem><para>The <command>patchadd</command> utility is able to add the
patch(es) to the global zone and to all non-global zones only. This is the
default action.</para>
</listitem><listitem><para>The <command>patchadd</command> utility cannot add the patch(es)
to the global zone only or to a subset of the non-global zones.</para>
</listitem>
</itemizedlist><para>When you add a patch to the global zone and to all non-global zones,
you do not have to consider whether the patch affects areas that are shared
from the global zone.</para><para>The following steps are performed by the <command>patchadd</command> utility:</para><itemizedlist><listitem><para>The patch is added to the global zone.</para>
</listitem><listitem><para>The patch database on the global zone is updated.</para>
</listitem><listitem><para>The patch is added to each non-global zone.</para>
</listitem><listitem><para>The patch database on each non-global zone is updated.</para>
</listitem>
</itemizedlist>
</sect2><sect2 id="z.pkginst.ov-33"><title>Using <command>patchadd</command> in a
Non-Global Zone</title><para>When used in a non-global zone by the zone administrator, <command>patchadd</command> can only be used to add patches to that zone. A patch can be added
to a non-global zone in the following cases:</para><itemizedlist><listitem><para>The patch does not affect any area of the zone that is shared
from the global zone.</para>
</listitem><listitem><para>All packages in the patch are set <literal>SUNW_PKG_ALLZONES=false</literal>.</para>
</listitem>
</itemizedlist><para>The following steps are performed by the <command>patchadd</command> utility:</para><itemizedlist><listitem><para>The patch is added to the zone.</para>
</listitem><listitem><para>The patch database on the zone is updated.</para>
</listitem>
</itemizedlist>
</sect2><sect2 id="gepbw"><title>Interaction of patchadd <option>G</option> and the <literal>pkginfo</literal> Variable on a System With Zones</title><para>The following list specifies the interaction between the <option>G</option> option
and the <literal>SUNW_PKG_ALLZONES</literal> variable when adding a patch
in global and non-global zones.</para><variablelist><varlistentry><term>Global zone, <option>G</option> specified</term><listitem><para>If any packages have <literal>SUNW_PKG_ALLZONES=TRUE</literal>,
this use results in an error and no action.</para><para>If no packages have <literal>SUNW_PKG_ALLZONES=TRUE</literal>, patch
is applied to package(s) in global zone only.</para>
</listitem>
</varlistentry><varlistentry><term>Global zone, <option>G</option> not specified</term><listitem><para>If any packages have <literal>SUNW_PKG_ALLZONES=TRUE</literal>,
patch is applied to those package(s) in all zones.</para><para>If any packages do not have <literal>SUNW_PKG_ALLZONES=TRUE</literal>,
patch is applied to those package(s) in all appropriate zones. Global zone
only packages are installed only in the global zone.</para>
</listitem>
</varlistentry><varlistentry><term>Non-global zone, <option>G</option> specified or not specified</term><listitem><para>If any packages have <literal>SUNW_PKG_ALLZONES=TRUE</literal>,
this use results in an error and no action.</para><para>If no packages have <literal>SUNW_PKG_ALLZONES=TRUE</literal>, patch
is applied to packages in non-global zone only.</para>
</listitem>
</varlistentry>
</variablelist>
</sect2>
</sect1><sect1 id="z.pkginst.ov-24"><title>Removing Patches on a Solaris System With
Zones Installed</title><para>The <command>patchrm</command> system utility described in the <olink targetdoc="group-refman" targetptr="patchrm-1m" remap="external"><citerefentry><refentrytitle>patchrm</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man page
is used to remove patches on a system with zones installed.</para><sect2 id="z.pkginst.ov-35"><title>Using <command>patchrm</command> in the
Global Zone</title><para>As the global administrator, you can use the <command>patchrm</command> utility
in the global zone to remove patches. The <command>patchrm</command> utility
cannot remove patches from the global zone only or from a subset of the non-global
zones.</para>
</sect2><sect2 id="z.pkginst.ov-34"><title>Using <command>patchrm</command> in a Non-Global
Zone</title><para>As the zone administrator, you can use the <command>patchrm</command> utility
in a non-global zone to remove patches from that non-global zone only. Patches
cannot affect areas that are shared.</para>
</sect2>
</sect1><sect1 id="z.pkginst.ov-20"><title>PatchPro Support</title><para>PatchPro can be used in the global zone and in any non-global
zone. If run in the global zone, PatchPro uses the existing patch database
and patch tools to patch the global and all non-global zones for all software
that is installed on the global zone. No software installed in a non-global
zone that is not also installed in the global zone will be taken into account.</para><para>A zone administrator can run PatchPro in a non-global zone to patch
the software installed in the non-global zone.</para>
</sect1><sect1 id="z.pkginst.ov-19"><title>Product Database</title><para>Each zone's respective package, patch, and product registry database
completely describes all installed software that is available on the zone.
All dependency checking for installing additional software or patches is performed
without accessing any other zone's database, unless a package or patch is
being installed or removed on the global zone and on one or more non-global
zones. In this case, the appropriate non-global zone database(s) must be accessed.</para><para>For more information about the database, see the <olink targetdoc="group-refman" targetptr="pkgadm-1m" remap="external"><citerefentry><refentrytitle>pkgadm</refentrytitle><manvolnum>1M</manvolnum></citerefentry></olink> man page.</para>
</sect1>
</chapter>